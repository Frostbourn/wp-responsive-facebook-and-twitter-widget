const container=document.querySelector(".instagram-widget"),widgetSetting={id:container.dataset.user,color:container.dataset.color,showHeader:container.dataset.header};let header=document.createElement("div"),statsPanel=document.createElement("div"),gallery=document.createElement("div"),footer=document.createElement("div");const nFormat=num=>num>=1e6?(num/1e6).toFixed(1).replace(/\.0$/,"")+"m":num>=1e3?(num/1e3).toFixed(1).replace(/\.0$/,"")+"k":num;(async()=>{try{const url=await axios.get(`https://www.instagram.com/${widgetSetting.id}`).then(fetchData=>{let instagramRegExp=new RegExp(/<script type="text\/javascript">window\._sharedData = (.*);<\/script>/),values=fetchData.data.match(instagramRegExp)[1],parsedResponse,userData;return JSON.parse(values).entry_data.ProfilePage[0].graphql.user}).then(userData=>{let edges,photos;return"yes"==widgetSetting.showHeader?(header.classList.add("widget-header"),header.innerHTML=`\n                            <img src="${userData.profile_pic_url}" class="widget-header__avatar">\n                            <span class="widget-header__username">${userData.full_name}</span>\n                            <a href="https://instagram.com/${widgetSetting.id}" class="widget-button" target="_blank" style="${widgetSetting.color}">Follow</a>\n                            `,container.appendChild(header),statsPanel.classList.add("widget-panel"),statsPanel.innerHTML=`<p class=widget-panel__stats>${nFormat(userData.edge_owner_to_timeline_media.count)}<br /> <span>posts</span>\n                         <p class=widget-panel__stats>${nFormat(userData.edge_followed_by.count)}<br /> <span>followers</span>\n                         <p class=widget-panel__stats>${nFormat(userData.edge_follow.count)}<br /> <span>following</span>`,container.appendChild(statsPanel)):"no"==widgetSetting.showHeader&&(container.style.border="none",container.style.boxShadow="none"),gallery.classList.add("widget-gallery"),container.appendChild(gallery),userData.edge_owner_to_timeline_media.edges.splice(0,12).map(({node:node})=>({url:`https://www.instagram.com/p/${node.shortcode}/`,thumbnailUrl:node.thumbnail_src,displayUrl:node.display_url,caption:node.edge_media_to_caption.edges[0].node.text,likesCount:node.edge_liked_by.count,commentCount:node.edge_media_to_comment.count}))}).then(photos=>{photos.forEach(photo=>{photo.caption?photo.caption=photo.caption.node.text:photo.caption=" ",photo.likesCount>0?photo.likesCount="<span>&#x2764;</span> "+nFormat(photo.likesCount):photo.likesCount=" ",photo.commentCount>0?photo.commentCount="<span>&#x1F4AC;</span> "+nFormat(photo.commentCount):photo.commentCount=" ";let picture=document.createElement("p");picture.innerHTML=`\n                    <a href="${photo.url}" target="_blank" rel="noopener noreferrer" class="widget-gallery__link">\n                        <img src="${photo.thumbnailUrl}" alt="${photo.caption}" class="widget-gallery__image">\n                        <div class="widget-gallery__caption">\n                            <p>${photo.caption}</br>\n                               ${photo.likesCount} ${photo.commentCount}</br>\n                            </p>\n                        </div>\n                    </a>\n                    `,gallery.appendChild(picture)})})}catch(e){throw"Unable to retrieve photos. Reason: "+e}})();